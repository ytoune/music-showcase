(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{6159:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return Ne}});var t=n(1720),u=n(6515),c=n(1173),o=n(8510),i=n(9127),a=new u.X(0),s=function(e){return a.next(e)},f=Number("u">typeof localStorage&&localStorage.getItem("my:cursor"))||0,l=a.pipe((0,c.R)((function(e,r){return e+r}),f),(0,o.d)(1)),p=a.pipe((0,i.U)((function(e){return!e})),(0,o.d)(1));s(1),s(-1);var d=n(5944),v=new(n(2649).x),m=function(e){v.next(e)},b=v.pipe((0,o.d)(1)),h=n(3321),y=function(){var e=(0,t.useRef)(null),r=(0,t.useCallback)((function(){null!=e.current&&e.current.click()}),[]),n=(0,t.useCallback)((function(e){e.target.files&&Array.from(e.target.files).map(m)}),[]);return(0,d.BX)(d.HY,{children:[(0,d.tZ)(h.Z,{onClick:r,variant:"outlined",children:"upload zip file"}),(0,d.tZ)("input",{type:"file",ref:e,style:{display:"none"},onChange:n})]})},w=n(4978),Z=n(6174),O=n(29),g=n(7794),k=n.n(g),x=n(5733),E=n(6835),j=n(7812),P=n(983),C=n(9499),D="RESET",A="ADD",S="DONE",N=new u.X(D),_=function(e){return N.next(e)},R=N.pipe((0,c.R)((function(e,r){var n=(0,E.Z)(e,2),t=n[0],u=n[1];switch(r){case D:return[t-u,0];case A:return[t,u+1];case S:return[t+1,u];default:return[t,u]}}),[0,0]),(0,i.U)((function(e){var r=(0,E.Z)(e,2),n=r[0],t=r[1];return{done:Math.max(0,n),total:t,progress:t?Math.max(0,n)/t:0}})),(0,o.d)(1));function U(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function L(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?U(Object(n),!0).forEach((function(r){(0,C.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var T=function(){var e=(0,O.Z)(k().mark((function e(r){var t,u,c,o,i;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(A),_(A),e.next=4,Promise.all([n.e(463),n.e(839)]).then(n.bind(n,2463));case 4:return t=e.sent,u=t.parseBlob,c=r.name,e.next=9,r.async("blob");case 9:return o=e.sent,_(S),e.next=13,u(o);case 13:return i=e.sent,_(S),e.abrupt("return",L(L({name:c},i),{},{blob:o}));case 16:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),X=n(4730),B=function(e){return e.trim().split(/\r?\n/gi).map((function(e){return e.trim()})).filter(Boolean).map((function(e){var r,n,t,u=e.split(/\t/gi).map((function(e){return e.trim()}));return{filename:null===(r=u[0])||void 0===r?void 0:r.trim(),start:null===(n=u[1])||void 0===n?void 0:n.trim(),end:null===(t=u[2])||void 0===t?void 0:t.trim()}}))},M=["name"];function I(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function H(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?I(Object(n),!0).forEach((function(r){(0,C.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var z=function(){var e=(0,O.Z)(k().mark((function e(r){var n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(A),e.t0=B,e.next=4,r.async("text");case 4:return e.t1=e.sent,n=(0,e.t0)(e.t1).map(q).filter(Y).reduce(G,{}),_(S),e.abrupt("return",F(n));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),F=function(e){return function(r){return r.map((function(r){var n=r.name,t=(0,X.Z)(r,M);return H({name:n,preview:e[n]||{}},t)}))}},Y=function(e){return!!e.filename&&Number.isFinite(e.start)&&Number.isFinite(e.end)},q=function(e){var r=e.filename,n=e.start,t=e.end;return{filename:r,start:$(n),end:$(t)}},$=function(e){if(e){var r=/^(\d+):(\d+)(\.\d+|)$/.exec(e);if(r){var n=r.slice(1).map(J),t=(0,E.Z)(n,3);return 60*t[0]+t[1]+t[2]}}},G=function(e,r){var n=r.filename,t=r.start,u=r.end;return H(H({},e),{},(0,C.Z)({},n,{start:t,end:u}))},J=function(e){return Number(e)||0},K=function(){var e=(0,O.Z)(k().mark((function e(r){var n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.dir){e.next=2;break}return e.abrupt("return",[0,null]);case 2:if(e.prev=2,!(n=(0,P.lookup)(r.name))||"audio/"!==n.slice(0,6)){e.next=11;break}return e.t0=Q,e.next=8,T(r);case 8:return e.t1=e.sent,e.t2=(0,e.t0)(e.t1),e.abrupt("return",[1,e.t2]);case 11:if("text/tab-separated-values"!==n){e.next=16;break}return e.next=14,z(r);case 14:return e.t3=e.sent,e.abrupt("return",[9,e.t3]);case 16:return e.abrupt("return",[0,null]);case 19:if(e.prev=19,e.t4=e.catch(2),!/(^|\/)\./.test(r.name)){e.next=23;break}return e.abrupt("return",[0,null]);case 23:throw e.t4;case 24:case"end":return e.stop()}}),e,null,[[2,19]])})));return function(r){return e.apply(this,arguments)}}(),Q=function(e){return function(r){return[].concat((0,j.Z)(r),[e])}},V=function(e,r){var n=(0,E.Z)(r,2),t=(n[0],n[1]);return"function"===typeof t?t(e):e},W=function(e,r){return(0,E.Z)(e,1)[0]-(0,E.Z)(r,1)[0]},ee=function(){var e=(0,O.Z)(k().mark((function e(r){var t,u,c,o;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(D),_(A),e.next=4,n.e(456).then(n.t.bind(n,5456,23));case 4:return t=e.sent,u=t.convert,e.next=8,(0,x.loadAsync)(r,{decodeFileName:function(e){return Array.isArray(e)?function(){throw new Error("\u30a8\u30e9\u30fc")}():u(e,{to:"UNICODE",from:"AUTO",type:"string"})}});case 8:return c=e.sent,_(S),o=[],c.forEach((function(e,r){return o.push(r)})),e.next=14,Promise.all(o.map(K));case 14:return e.abrupt("return",e.sent.sort(W).reduce(V,[]));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),re=n(2777),ne=n(2262),te="files",ue=function(){function e(r,n){(0,re.Z)(this,e),this.open=r,this.key=n}return(0,ne.Z)(e,[{key:"read",value:function(){var e=this;return ce(this.open,"readonly",(function(r){return new Promise((function(n,t){var u=r.get(e.key);u.onerror=t,u.onsuccess=function(){var e;n(null===(e=u.result)||void 0===e?void 0:e.val)}}))}))}},{key:"write",value:function(e){var r=this;return ce(this.open,"readwrite",(function(n){return new Promise((function(t,u){var c=n.put({ssn:r.key,val:e});c.onerror=u,c.onsuccess=function(){t(c.result)}}))}))}}]),e}(),ce=function(){var e=(0,O.Z)(k().mark((function e(r,n,t){var u,c;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:return u=e.sent,e.prev=3,c=u.transaction([te],n).objectStore(te),e.next=7,t(c);case 7:return e.abrupt("return",e.sent);case 8:return e.prev=8,u.close(),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[3,,8,11]])})));return function(r,n,t){return e.apply(this,arguments)}}(),oe=n(2817),ie=n(9293),ae=new ue((function(){return new Promise((function(e,r){try{var n=indexedDB.open("app",1);n.onerror=r,n.onupgradeneeded=function(e){e.target.result.createObjectStore(te,{keyPath:"ssn"})},n.onsuccess=function(r){var n=r.target.result;e(n)}}catch(t){r(t)}}))}),"files"),se=new ie.y((function(e){var r=!0;return ae.read().catch((function(e){console.error(e)})).then((function(n){n&&r&&(e.next(n),setTimeout(fe,10)),e.complete()})),{unsubscribe:function(){r=!1}}})),fe=function(){var e=document.body,r=document.createElement("div");r.style.position="fixed",r.style.top="0",r.style.bottom="0",r.style.right="0",r.style.left="0",r.style.zIndex="99999999",r.addEventListener("click",(function(){var n;e.removeChild(r),null===(n=e.querySelector("audio"))||void 0===n||n.play()})),e.appendChild(r)},le="LOAD_CACHE",pe=b.pipe((0,w.w)(ee),(0,i.U)((function(e){return e.slice().sort((function(e,r){return e.name.localeCompare(r.name,[],{numeric:!0})}))})),(0,Z.O)(le),(0,w.w)((function(e){return le===e?se:function(e){return ae.write(e).catch((function(e){console.error(e)})),(0,oe.of)(e)}(e)})),(0,o.d)(1)),de=function(e){var r=e.start,n=e.end,u=e.src,c=e.onEnded,o=(0,t.useRef)(null);(0,t.useEffect)((function(){var e=p.subscribe((function(e){return e&&void(null!=o.current&&(o.current.currentTime=0))})),r=Number(localStorage.getItem("my:volume"));return o.current&&r&&(o.current.volume=r),function(){return e.unsubscribe()}}),[]);var i=(0,t.useCallback)((function(e){var t=e.target;if(t instanceof HTMLAudioElement){var u=t.currentTime,c="number"===typeof r?r:0;switch(!0){case"number"!==typeof u:case"number"===typeof n&&n<c:return;case u<c:case n&&n<=u:return void(t.currentTime=c)}}}),[r,n]),a=(0,t.useCallback)((function(){return c((function(){null!=o.current&&o.current.play()}))}),[c]);return(0,d.tZ)("audio",{src:u,ref:o,controls:!0,autoPlay:!0,onEnded:a,onTimeUpdate:i})},ve=n(5113),me=n(8905),be=n(7275),he=n(8462),ye=function(e){var r=e.files;if(!r.length)return(0,d.BX)(ve.Z,{sx:{textAlign:"center",padding:"80px 30px"},children:["\u4e0b\u306e\u30dc\u30bf\u30f3\u304b\u3089",(0,d.tZ)("br",{}),"mp3 \u3092 zip \u3067",(0,d.tZ)("br",{}),"\u307e\u3068\u3081\u3066\u3042\u3052\u3066\u304f\u3060\u3055\u3044\u3002",(0,d.tZ)("br",{}),(0,d.tZ)("a",{href:"https://github.com/ytoune/music-showcase/blob/master/README.md",target:"_blank",rel:"noopener noreferrer",children:"\u4f7f\u3044\u65b9"})]});var n=r.map((function(e,r){var n=e.name,t=e.common,u=t.artists,c=t.title;return(0,d.tZ)(me.ZP,{button:!0,onClick:function(){return s(r)},selected:!r,children:(0,d.tZ)(be.Z,{primary:c||n,secondary:u&&u.join(", ")})},n)}));return n.unshift.apply(n,(0,j.Z)(n.splice(-1))),(0,d.tZ)(he.Z,{children:n})},we=function(e){var r=e.show,n=e.children;return(0,d.tZ)(d.HY,{children:r?n:null})},Ze=n(3365),Oe=n(1927),ge=n(8815),ke=n(1265),xe=(0,ke.Z)({palette:{primary:{main:"#000"}}}),Ee=(0,ke.Z)({palette:{mode:"dark",primary:{main:"#fff"}}}),je=function(e,r){var n=(0,t.useState)(r),u=n[0],c=n[1];return(0,t.useEffect)((function(){var r=e.subscribe(c);return function(){r.unsubscribe()}}),[]),u},Pe=function(e){switch(e.key){case"ArrowUp":s(-1);break;case"ArrowDown":s(1);break;case"ArrowRight":case"ArrowLeft":case" ":case"Enter":s(0);break;case"Escape":s(1),s(-1)}},Ce=function(){return je(R,{})},De=function(){return je(p,!1)},Ae=function(){return s(-1)},Se=function(){return s(1)},Ne=function(){var e=function(){var e=je(pe,[]),r=je(l,0);return(0,t.useEffect)((function(){return document.body.addEventListener("keydown",Pe),function(){document.body.removeEventListener("keydown",Pe)}}),[]),(0,t.useMemo)((function(){var n=e.length,t=n?r%n:0;return"u">typeof localStorage&&localStorage.setItem("my:cursor",String(1+t)),[].concat((0,j.Z)(e.slice(t)),(0,j.Z)(e.slice(0,t)))}),[e,r])}(),r=De(),n=Ce(),u=n.total,c=void 0===u?0:u,o=n.progress,i=void 0===o?0:o,a=function(e){var r=(0,t.useMemo)((function(){return e[0]||{}}),[e]),n=r.blob,u=r.preview,c=(u=void 0===u?{}:u).start,o=void 0===c?0:c,i=u.end,a=void 0===i?0:i,s=(0,t.useRef)({url:""});return{url:(0,t.useMemo)((function(){return s.current.url&&URL.revokeObjectURL(s.current.url),n?s.current.url=URL.createObjectURL(n):""}),[n]),start:o,end:a}}(e),f=a.url,p=a.start,v=a.end,m=(0,t.useCallback)((function(e){return r?e():s(1)}),[r]);return(0,d.tZ)("div",{children:(0,d.BX)(Oe.Z,{theme:r&&f?Ee:xe,children:[(0,d.tZ)(ge.ZP,{}),(0,d.BX)(ve.Z,{className:"main",children:[(0,d.BX)("header",{children:[(0,d.tZ)(we,{show:!!c&&i<1,children:(0,d.tZ)(Ze.Z,{variant:"determinate",value:Math.floor(100*i)})}),(0,d.tZ)(we,{show:!!f,children:(0,d.tZ)(de,{src:f,start:!r&&p,end:!r&&v,onEnded:m})})]}),(0,d.tZ)("main",{children:(0,d.tZ)(ye,{files:e})}),(0,d.BX)("footer",{children:[(0,d.tZ)(h.Z,{onClick:Ae,variant:"outlined",children:"up"}),(0,d.tZ)(h.Z,{onClick:Se,variant:"outlined",children:"down"}),(0,d.tZ)(y,{})]})]})]})})}},8312:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6159)}])}},function(e){e.O(0,[167,774,888,179],(function(){return r=8312,e(e.s=r);var r}));var r=e.O();_N_E=r}]);